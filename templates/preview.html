<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Preview countdown {{ countdown_id }}</title>
  <style>
    body {
	    font-family: Arial, sans-serif;
	    background: #f5f5f5;
	    padding: 20px;
	    }
    h1 {
	    margin-bottom: 5px;
	    }
    .small {
	    font-size: 12px;
	    color: #666;
	    }
    .box {
	    background: #fff;
	    padding: 20px;
	    border-radius: 10px;
	    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
	    margin-top: 20px;
	    }
    #htmlPreview {
	    width: 100%;
	    max-width: 600px;
	    height: 200px;
	    border-radius: 10px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-weight: bold;
	    margin: 0 auto 15px;
	    }
    img {
	    max-width: 100%;
	    border-radius: 10px;
	    border: 1px solid #ccc;
	    }
    code {
	    background: #eee;
	    padding: 3px 5px;
	    border-radius: 4px;
	    font-size: 13px;
	    }
  </style>
</head>
<body>

  <h1>Preview countdown <code>{{ countdown_id }}</code></h1>
  <p class="small">
    <a href="/list">⬅ Retour à la liste</a> •
    <a href="{{ gif_url }}" target="_blank">Voir le GIF seul</a>
  </p>

  <div class="box">
    <h2>Aperçu HTML (simulation)</h2>
    <div id="htmlPreview"></div>
    <p class="small">Cet aperçu HTML simule le compte à rebours. Le GIF réel est ci-dessous.</p>
  </div>

  <div class="box">
    <h2>GIF dynamique réel</h2>
    <img src="{{ gif_url }}" alt="GIF countdown {{ countdown_id }}">
    <p class="small">
      Code HTML :<br>
      <code>&lt;img src="{{ gif_url }}" alt="Countdown"&gt;</code>
    </p>
  </div>

  <script>
    const preview = document.getElementById("htmlPreview");
    const targetDateStr = "{{ target_date }}";
    const bg = "{{ config.background_color }}";
    const txt = "{{ config.text_color }}";
    const size = {{ config.font_size }};
    const prefix = "{{ config.message_prefix }}";
    
    function updatePreview() {
	    preview.style.backgroundColor = bg;
	    preview.style.color = txt;
	    preview.style.fontSize = size + "px";
	    
	    const target = new Date(targetDateStr);
	    const now = new Date();
	    const diff = target - now;
	    
	    if (isNaN(diff) || diff <= 0) {
		    preview.textContent = "⏰ Terminé !";
		    return;
	    }
	    
	    const totalSeconds = Math.floor(diff / 1000);
	    const days = Math.floor(totalSeconds / 86400);
	    const hours = Math.floor((totalSeconds % 86400) / 3600);
	    const minutes = Math.floor((totalSeconds % 3600) / 60);
	    const seconds = totalSeconds % 60;
	    
	    preview.textContent =
			    `${prefix}${days}j ${
					    String(hours).padStart(2,"0")}:${
					    String(minutes).padStart(2,"0")}:${
					    String(seconds).padStart(2,"0")}`;
    }
    
    setInterval(updatePreview, 1000);
    updatePreview();
  </script>

</body>
</html>