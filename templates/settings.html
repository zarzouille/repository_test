<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cr√©er un compte √† rebours</title>
  <style>
    body {
	    font-family: Arial, sans-serif;
	    background: #f5f5f5;
	    margin: 0;
	    padding: 20px;
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	    gap: 20px;
	    }
    
    h1 {
	    margin-bottom: 10px;
	    }
    
    .container {
	    width: 100%;
	    max-width: 900px;
	    display: flex;
	    flex-direction: column;
	    gap: 25px;
	    }
    
    form {
	    background: #fff;
	    padding: 25px;
	    border-radius: 12px;
	    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
	    display: grid;
	    grid-template-columns: 1fr 1fr;
	    gap: 20px;
	    }
    
    label {
	    font-size: 14px;
	    margin-bottom: 5px;
	    display: block;
	    }
    
    input[type="text"],
    input[type="datetime-local"],
    input[type="color"],
    input[type="number"] {
	    width: 100%;
	    padding: 7px;
	    font-size: 15px;
	    box-sizing: border-box;
	    }
    
    .full-row {
	    grid-column: 1 / 3;
	    }
    
    button {
	    grid-column: 1 / 3;
	    padding: 12px;
	    font-size: 17px;
	    background: #007bff;
	    color: #fff;
	    border: none;
	    border-radius: 6px;
	    cursor: pointer;
	    }
    
    button:hover {
	    background: #0056b3;
	    }
    
    .preview-box,
    .link-box {
	    background: #fff;
	    padding: 25px;
	    border-radius: 12px;
	    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
	    }
    
    #htmlPreview {
	    width: 100%;
	    max-width: 600px;
	    height: 200px;
	    border-radius: 12px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-weight: bold;
	    margin: 0 auto;
	    }
    
    .small {
	    font-size: 13px;
	    color: #666;
	    }
    
    .link-input {
	    width: 100%;
	    font-size: 15px;
	    padding: 8px;
	    box-sizing: border-box;
	    margin-top: 10px;
	    }
    
    .img-code {
	    background: #eee;
	    padding: 10px;
	    border-radius: 6px;
	    font-size: 14px;
	    margin-top: 8px;
	    }

  </style>
</head>
<body>

  <h1>üïí Cr√©er un nouveau compte √† rebours</h1>
  <p class="small">Chaque sauvegarde g√©n√®re un nouveau countdown ind√©pendant avec son propre lien.</p>

  <div class="container">

    <!-- FORMULAIRE -->
    <form method="POST" id="configForm">
      <div class="full-row">
        <label>Date cible :</label>
        <input type="datetime-local" name="target_date" id="target_date" value="{{ target_date }}" required>
      </div>

      <div>
        <label>Couleur de fond :</label>
        <input type="color" name="background_color" id="background_color" value="{{ config.background_color }}">
      </div>

      <div>
        <label>Couleur du texte :</label>
        <input type="color" name="text_color" id="text_color" value="{{ config.text_color }}">
      </div>

      <div>
        <label>Taille du texte (px) :</label>
        <input type="number" name="font_size" id="font_size" min="10" max="150" value="{{ config.font_size }}">
      </div>

      <div class="full-row">
        <label>Pr√©fixe du message :</label>
        <input type="text" name="message_prefix" id="message_prefix" value="{{ config.message_prefix }}">
      </div>

      <button type="submit">‚ú® G√©n√©rer un nouveau countdown</button>
    </form>
	  
	  
	  <!-- PREVIEW HTML -->
    <div class="preview-box">
      <h2>Aper√ßu en direct</h2>
      <div id="htmlPreview">Chargement‚Ä¶</div>
      <p class="small">Ceci est un aper√ßu HTML. Le GIF final sera g√©n√©r√© automatiquement pour ton lien.</p>
    </div>

    {% if img_link %}
	  
	  <!-- LIEN DU COUNTDOWN -->
    <div class="link-box">
      <h2>üéâ Countdown g√©n√©r√© !</h2>

      <p class="small">Voici ton lien unique (GIF dynamique) :</p>

      <input class="link-input" readonly value="{{ img_link }}" onclick="this.select()">

      <p class="small">Code HTML pr√™t √† coller dans ton email :</p>

      <div class="img-code">
        &lt;img src="{{ img_link }}" alt="Countdown"&gt;
      </div>

    </div>

    {% endif %}

  </div>
  
  
  <!-- SCRIPT PREVIEW DYNAMIQUE -->
  <script>
    const preview = document.getElementById("htmlPreview");
    
    function updatePreview() {
	    const bg = document.getElementById("background_color").value;
	    const txt = document.getElementById("text_color").value;
	    const size = parseInt(document.getElementById("font_size").value, 10);
	    const prefix = document.getElementById("message_prefix").value;
	    const dateInput = document.getElementById("target_date").value;
	    
	    preview.style.backgroundColor = bg;
	    preview.style.color = txt;
	    preview.style.fontSize = size + "px";
	    
	    if (!dateInput) {
		    preview.textContent = "Choisis une date pour voir l‚Äôaper√ßu.";
		    return;
	    }
	    
	    const target = new Date(dateInput);
	    const now = new Date();
	    const diff = target - now;
	    
	    if (isNaN(diff) || diff <= 0) {
		    preview.textContent = "‚è∞ Termin√© !";
		    return;
	    }
	    
	    const totalSeconds = Math.floor(diff / 1000);
	    const days = Math.floor(totalSeconds / 86400);
	    const hours = Math.floor((totalSeconds % 86400) / 3600);
	    const minutes = Math.floor((totalSeconds % 3600) / 60);
	    const seconds = totalSeconds % 60;
	    
	    preview.textContent =
			    `${prefix}${days}j ${
					    String(hours).padStart(2,"0")}:${
					    String(minutes).padStart(2,"0")}:${
					    String(seconds).padStart(2,"0")}`;
    }
    
    // Mise √† jour continue
    setInterval(updatePreview, 1000);
    document.getElementById("configForm").addEventListener("input", updatePreview);
    
    updatePreview();
  </script>

</body>
</html>
