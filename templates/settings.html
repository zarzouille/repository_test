<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cr√©er un compte √† rebours</title>
  <style>
    body {
	    font-family: Arial, sans-serif;
	    background: #f5f5f5;
	    margin: 0;
	    padding: 20px;
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	    gap: 20px;
	    }
    
    h1 {
	    margin-bottom: 4px;
	    }
    
    .small {
	    font-size: 13px;
	    color: #666;
	    }
    
    .container {
	    width: 100%;
	    max-width: 1100px;
	    display: flex;
	    flex-direction: column;
	    gap: 25px;
	    }
    
    .card {
	    background: #ffffff;
	    padding: 20px;
	    border-radius: 12px;
	    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
	    }
    
    .card h2 {
	    margin-top: 0;
	    font-size: 18px;
	    margin-bottom: 10px;
	    }
    
    form {
	    display: grid;
	    grid-template-columns: repeat(3, minmax(0,1fr));
	    gap: 15px 20px;
	    }
    
    label {
	    font-size: 13px;
	    margin-bottom: 4px;
	    display: block;
	    }
    
    input[type="text"],
    input[type="datetime-local"],
    input[type="color"],
    input[type="number"],
    select {
	    width: 100%;
	    padding: 6px;
	    font-size: 14px;
	    box-sizing: border-box;
	    }
    
    .full-row {
	    grid-column: 1 / 4;
	    }
    
    .section-title {
	    grid-column: 1 / 4;
	    margin-top: 10px;
	    font-weight: bold;
	    font-size: 14px;
	    border-bottom: 1px solid #eee;
	    padding-bottom: 4px;
	    }
    
    .checkbox-row {
	    display: flex;
	    align-items: center;
	    gap: 6px;
	    margin-top: 4px;
	    }
    
    button {
	    grid-column: 1 / 4;
	    padding: 12px;
	    font-size: 16px;
	    background: #007bff;
	    color: #fff;
	    border: none;
	    border-radius: 6px;
	    cursor: pointer;
	    }
    
    button:hover {
	    background: #0056b3;
	    }
    
    #htmlPreview {
	    width: 100%;
	    max-width: 700px;
	    height: 200px;
	    border-radius: 12px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-weight: bold;
	    margin: 0 auto;
	    text-align: center;
	    padding: 10px;
	    box-sizing: border-box;
	    }
    
    .link-input {
	    width: 100%;
	    font-size: 14px;
	    padding: 7px;
	    box-sizing: border-box;
	    }
    
    .code {
	    background: #eee;
	    padding: 8px;
	    border-radius: 6px;
	    font-family: monospace;
	    font-size: 13px;
	    margin-top: 6px;
	    overflow-x: auto;
	    }

  </style>
</head>
<body>

  <h1>üïí Cr√©er un nouveau compte √† rebours</h1>
  <p class="small">
    Chaque sauvegarde g√©n√®re un ID unique et un GIF permanent.
    Pour g√©rer tous les countdowns : <a href="/admin" target="_blank">Admin</a>
  </p>

  <div class="container">

    <!-- FORMULAIRE PRINCIPAL -->
    <div class="card">
      <h2>Configuration</h2>

      <form method="POST" id="configForm">
        <div class="section-title">G√©n√©ral</div>

        <div class="full-row">
          <label>Date cible :</label>
          <input type="datetime-local" name="target_date" id="target_date" value="{{ target_date }}" required>
        </div>

        <div>
          <label>Template :</label>
          <select name="template" id="template">
            <option value="classic"  {% if config.template == 'classic'  %}selected{% endif %}>Classique</option>
	          <option value="blocks"   {% if config.template == 'blocks'   %}selected{% endif %}>Blocs</option>
	          <option value="flip"     {% if config.template == 'flip'     %}selected{% endif %}>Flip</option>
	          <option value="bubble"   {% if config.template == 'bubble'   %}selected{% endif %}>Bulles</option>
	          <option value="minimal"  {% if config.template == 'minimal'  %}selected{% endif %}>Minimal</option>
	          <option value="banner"   {% if config.template == 'banner'   %}selected{% endif %}>Banni√®re</option>
	          <option value="progress" {% if config.template == 'progress' %}selected{% endif %}>Barre de progression</option>
          </select>
        </div>

        <div>
          <label>Alignement :</label>
          <select name="alignment" id="alignment">
            <option value="left"   {% if config.alignment == 'left'   %}selected{% endif %}>Gauche</option>
	          <option value="center" {% if config.alignment == 'center' %}selected{% endif %}>Centr√©</option>
	          <option value="right"  {% if config.alignment == 'right'  %}selected{% endif %}>Droite</option>
          </select>
        </div>

        <div>
          <label>Padding (px) :</label>
          <input type="number" name="padding" id="padding" value="{{ config.padding }}" min="0" max="100">
        </div>

        <div class="section-title">Couleurs & police</div>

        <div>
          <label>Couleur de fond :</label>
          <input type="color" name="background_color" id="background_color" value="{{ config.background_color }}">
        </div>

        <div>
          <label>Couleur du texte :</label>
          <input type="color" name="text_color" id="text_color" value="{{ config.text_color }}">
        </div>

        <div>
          <label>Taille du texte (px) :</label>
          <input type="number" name="font_size" id="font_size" value="{{ config.font_size }}" min="10" max="150">
        </div>

        <div class="full-row">
          <label>Pr√©fixe du message :</label>
          <input type="text" name="message_prefix" id="message_prefix" value="{{ config.message_prefix }}">
        </div>

        <div class="section-title">Ic√¥ne</div>

        <div>
          <label>Ic√¥ne (ex: ‚è≥ üî• üéâ) :</label>
          <input type="text" name="icon" id="icon" value="{{ config.icon }}">
        </div>

        <div>
          <label>Position de l‚Äôic√¥ne :</label>
          <select name="icon_position" id="icon_position">
            <option value="left"   {% if config.icon_position == 'left'   %}selected{% endif %}>Avant le texte</option>
	          <option value="right"  {% if config.icon_position == 'right'  %}selected{% endif %}>Apr√®s le texte</option>
	          <option value="above"  {% if config.icon_position == 'above'  %}selected{% endif %}>Au-dessus</option>
          </select>
        </div>

        <div></div>

        <div class="section-title">Blocs (templates : Blocs / Flip / Bulles)</div>

        <div>
          <label>Fond des blocs :</label>
          <input type="color" name="block_bg_color" id="block_bg_color" value="{{ config.block_bg_color }}">
        </div>

        <div>
          <label>Contour des blocs :</label>
          <input type="color" name="block_border_color" id="block_border_color" value="{{ config.block_border_color }}">
        </div>

        <div>
          <label>√âpaisseur du contour (px) :</label>
          <input type="number" name="block_border_width" id="block_border_width" value="{{ config.block_border_width }}" min="0" max="10">
        </div>

        <div>
          <label>Rayon des coins (px) :</label>
          <input type="number" name="block_radius" id="block_radius" value="{{ config.block_radius }}" min="0" max="60">
        </div>

        <div>
          <label>Padding horizontal (px) :</label>
          <input type="number" name="block_padding_x" id="block_padding_x" value="{{ config.block_padding_x }}" min="0" max="80">
        </div>

        <div>
          <label>Padding vertical (px) :</label>
          <input type="number" name="block_padding_y" id="block_padding_y" value="{{ config.block_padding_y }}" min="0" max="80">
        </div>

        <div>
          <label>Espacement entre blocs (px) :</label>
          <input type="number" name="blocks_gap" id="blocks_gap" value="{{ config.blocks_gap }}" min="0" max="80">
        </div>

        <div class="section-title">Labels (J / H / M / S)</div>

        <div class="full-row">
          <div class="checkbox-row">
            <input type="checkbox" name="show_labels" id="show_labels" {% if config.show_labels %}checked{% endif %}>
            <label for="show_labels">Afficher les labels (J / H / M / S)</label>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" name="labels_custom" id="labels_custom" {% if config.labels_custom %}checked{% endif %}>
            <label for="labels_custom">Labels personnalis√©s</label>
          </div>
        </div>

        <div>
          <label>Couleur des labels :</label>
          <input type="color" name="label_color" id="label_color" value="{{ config.label_color }}">
        </div>

        <div>
          <label>Taille des labels (facteur) :</label>
          <input type="number" name="label_size_factor" id="label_size_factor" step="0.1" min="0.2" max="1.0" value="{{ config.label_size_factor }}">
        </div>

        <div></div>

        <div>
          <label>Texte jours :</label>
          <input type="text" name="label_days" id="label_days" value="{{ config.labels_personalized.days }}">
        </div>

        <div>
          <label>Texte heures :</label>
          <input type="text" name="label_hours" id="label_hours" value="{{ config.labels_personalized.hours }}">
        </div>

        <div>
          <label>Texte minutes :</label>
          <input type="text" name="label_minutes" id="label_minutes" value="{{ config.labels_personalized.minutes }}">
        </div>

        <div>
          <label>Texte secondes :</label>
          <input type="text" name="label_seconds" id="label_seconds" value="{{ config.labels_personalized.seconds }}">
        </div>

        <div class="section-title">Banni√®re</div>

        <div>
          <label>Fond de banni√®re :</label>
          <input type="color" name="banner_bg_color" id="banner_bg_color" value="{{ config.banner_bg_color }}">
        </div>

        <div>
          <label>Texte de banni√®re :</label>
          <input type="color" name="banner_text_color" id="banner_text_color" value="{{ config.banner_text_color }}">
        </div>

        <div></div>

        <div class="section-title">Barre de progression</div>

        <div>
          <label>Fond de barre :</label>
          <input type="color" name="progress_bg_color" id="progress_bg_color" value="{{ config.progress_bg_color }}">
        </div>

        <div>
          <label>Remplissage de barre :</label>
          <input type="color" name="progress_fg_color" id="progress_fg_color" value="{{ config.progress_fg_color }}">
        </div>

        <div>
          <label>Hauteur de barre (px) :</label>
          <input type="number" name="progress_height" id="progress_height" value="{{ config.progress_height }}" min="4" max="60">
        </div>

        <div>
          <label>Fen√™tre max (jours) :</label>
          <input type="number" name="progress_max_days" id="progress_max_days" value="{{ config.progress_max_days }}" min="1" max="365">
        </div>

        <div></div>
        <div></div>

        <button type="submit">‚ú® G√©n√©rer un nouveau countdown</button>
      </form>
    </div>
	  
	  <!-- PREVIEW HTML -->
    <div class="card">
      <h2>Aper√ßu HTML en direct</h2>
      <div id="htmlPreview">Chargement‚Ä¶</div>
      <p class="small">Cet aper√ßu reproduit le style du template choisi. Le GIF r√©el sera g√©n√©r√© pour chaque ID.</p>
    </div>
	  
	  <!-- LIEN DU COUNTDOWN G√âN√âR√â -->
    {% if img_link %}
      <div class="card">
        <h2>üéâ Countdown g√©n√©r√©</h2>
        <p class="small">Voici ton lien GIF dynamique :</p>
        <input class="link-input" readonly value="{{ img_link }}" onclick="this.select();">

        <p class="small">Code HTML pr√™t √† coller dans ton email :</p>
        <div class="code">
          &lt;img src="{{ img_link }}" alt="Countdown"&gt;
        </div>
      </div>
    {% endif %}

  </div>

  <script>
    const preview = document.getElementById("htmlPreview");
    
    function updatePreview() {
	    const template = document.getElementById("template").value;
	    const bg = document.getElementById("background_color").value;
	    const txt = document.getElementById("text_color").value;
	    const size = parseInt(document.getElementById("font_size").value || "40", 10);
	    const prefix = document.getElementById("message_prefix").value || "Temps restant : ";
	    const dateInput = document.getElementById("target_date").value;
	    
	    preview.style.backgroundColor = bg;
	    preview.style.color = txt;
	    preview.style.fontSize = size + "px";
	    
	    if (!dateInput) {
		    preview.textContent = "Choisis une date pour voir l‚Äôaper√ßu.";
		    return;
	    }
	    
	    const target = new Date(dateInput);
	    const now = new Date();
	    const diff = target - now;
	    
	    if (isNaN(diff) || diff <= 0) {
		    preview.textContent = "‚è∞ Termin√© !";
		    return;
	    }
	    
	    const totalSeconds = Math.floor(diff / 1000);
	    const days = Math.floor(totalSeconds / 86400);
	    const hours = Math.floor((totalSeconds % 86400) / 3600);
	    const minutes = Math.floor((totalSeconds % 3600) / 60);
	    const seconds = totalSeconds % 60;
	    
	    // Emulation visuelle selon le template
	    if (template === "minimal") {
		    preview.textContent =
				    `${String(days).padStart(2,"0")}:` +
				    `${String(hours).padStart(2,"0")}:` +
				    `${String(minutes).padStart(2,"0")}:` +
				    `${String(seconds).padStart(2,"0")}`;
	    } else if (template === "banner") {
		    preview.style.backgroundColor = document.getElementById("banner_bg_color").value;
		    preview.style.color = document.getElementById("banner_text_color").value;
		    preview.textContent =
				    `${prefix}${days} jours ${String(hours).padStart(2,"0")}h ` +
				    `${String(minutes).padStart(2,"0")}m ${String(seconds).padStart(2,"0")}s`;
	    } else if (template === "progress") {
		    const maxDays = parseInt(document.getElementById("progress_max_days").value || "30", 10);
		    const total = maxDays * 86400;
		    let ratio = 1 - (totalSeconds / total);
		    ratio = Math.max(0, Math.min(1, ratio));
		    const barBg = document.getElementById("progress_bg_color").value;
		    const barFg = document.getElementById("progress_fg_color").value;
		    
		    preview.innerHTML = `
          <div style="width:100%;max-width:600px;">
            <div style="width:100%;height:16px;border-radius:8px;background:${barBg};overflow:hidden;">
              <div style="width:${(ratio*100).toFixed(1)}%;height:100%;background:${barFg};"></div>
            </div>
            <div style="margin-top:8px;font-size:${size * 0.6}px;">
              ${prefix}${days}j ${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}
            </div>
          </div>
        `;
	    } else {
		    // Classic / blocks / flip / bubble -> aper√ßu simple type blocs
		    const labelDays = document.getElementById("label_days").value || "J";
		    const labelHours = document.getElementById("label_hours").value || "H";
		    const labelMinutes = document.getElementById("label_minutes").value || "M";
		    const labelSeconds = document.getElementById("label_seconds").value || "S";
		    const showLabels = document.getElementById("show_labels").checked;
		    const blockBg = document.getElementById("block_bg_color").value;
		    const blockBorder = document.getElementById("block_border_color").value;
		    
		    preview.innerHTML = `
          <div style="display:flex;gap:10px;align-items:center;justify-content:center;">
            <div style="padding:8px 12px;border-radius:10px;background:${blockBg};border:1px solid ${blockBorder};">
              <div>${String(days).padStart(2,"0")}</div>
              ${showLabels ? `<div style="font-size:${size*0.4}px;">${labelDays}</div>` : ""}
            </div>
            <div style="padding:8px 12px;border-radius:10px;background:${blockBg};border:1px solid ${blockBorder};">
              <div>${String(hours).padStart(2,"0")}</div>
              ${showLabels ? `<div style="font-size:${size*0.4}px;">${labelHours}</div>` : ""}
            </div>
            <div style="padding:8px 12px;border-radius:10px;background:${blockBg};border:1px solid ${blockBorder};">
              <div>${String(minutes).padStart(2,"0")}</div>
              ${showLabels ? `<div style="font-size:${size*0.4}px;">${labelMinutes}</div>` : ""}
            </div>
            <div style="padding:8px 12px;border-radius:10px;background:${blockBg};border:1px solid ${blockBorder};">
              <div>${String(seconds).padStart(2,"0")}</div>
              ${showLabels ? `<div style="font-size:${size*0.4}px;">${labelSeconds}</div>` : ""}
            </div>
          </div>
        `;
	    }
    }
    
    setInterval(updatePreview, 1000);
    document.getElementById("configForm").addEventListener("input", updatePreview);
    updatePreview();
  </script>

</body>
</html>