<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Cr√©er un compte √† rebours</title>
  <style>
    :root {
	    --bg: #0f172a;
	    --bg-elevated: #020617;
	    --card: #020617;
	    --border-subtle: #1e293b;
	    --accent: #6366f1;
	    --accent-soft-bg: rgba(99,102,241,0.08);
	    --text-main: #e5e7eb;
	    --text-soft: #9ca3af;
	    --text-soft2: #6b7280;
	    --radius-lg: 16px;
	    --radius-md: 10px;
	    --shadow-soft: 0 18px 45px rgba(15,23,42,0.55);
	    }
    
    * {
	    box-sizing: border-box;
	    }
    
    body {
	    margin: 0;
	    min-height: 100vh;
	    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
	    background: radial-gradient(circle at top left, #1e293b 0, #020617 35%, #020617 100%);
	    color: var(--text-main);
	    padding: 24px;
	    display: flex;
	    flex-direction: column;
	    align-items: stretch;
	    }
    
    a {
	    color: var(--accent);
	    text-decoration: none;
	    }
    
    a:hover {
	    text-decoration: underline;
	    }
    
    .page-wrapper {
	    max-width: 1280px;
	    width: 100%;
	    margin: 0 auto;
	    }
    
    /* HEADER */
    
    .header {
	    display: flex;
	    align-items: center;
	    justify-content: space-between;
	    margin-bottom: 24px;
	    gap: 16px;
	    }
    
    .header-left {
	    display: flex;
	    flex-direction: column;
	    gap: 4px;
	    }
    
    .title-row {
	    display: flex;
	    align-items: center;
	    gap: 10px;
	    font-size: 22px;
	    font-weight: 600;
	    }
    
    .pill {
	    font-size: 11px;
	    text-transform: uppercase;
	    letter-spacing: 0.1em;
	    padding: 4px 10px;
	    border-radius: 999px;
	    background: rgba(15,23,42,0.9);
	    color: var(--text-soft);
	    border: 1px solid rgba(148,163,184,0.3);
	    }
    
    .subtitle {
	    font-size: 13px;
	    color: var(--text-soft);
	    }
    
    .header-actions {
	    display: flex;
	    align-items: center;
	    gap: 8px;
	    }
    
    .btn-ghost {
	    padding: 7px 12px;
	    border-radius: 999px;
	    border: 1px solid rgba(148,163,184,0.5);
	    background: transparent;
	    color: var(--text-soft);
	    font-size: 13px;
	    display: inline-flex;
	    align-items: center;
	    gap: 6px;
	    cursor: pointer;
	    }
    
    .btn-ghost:hover {
	    border-color: var(--accent);
	    color: #e5e7eb;
	    }
    
    .btn-ghost span.icon {
	    font-size: 14px;
	    }
    
    /* LAYOUT */
    
    .layout {
	    display: grid;
	    grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.7fr);
	    gap: 20px;
	    align-items: flex-start;
	    }
    
    @media (max-width: 960px) {
	    .layout {
		    grid-template-columns: minmax(0, 1fr);
		    }
	    .preview-wrapper {
		    position: static;
		    }
	    }
    
    /* CARDS */
    
    .card {
	    background: radial-gradient(circle at top left, #0b1120 0, #020617 40%, #020617 100%);
	    border-radius: var(--radius-lg);
	    border: 1px solid var(--border-subtle);
	    box-shadow: var(--shadow-soft);
	    padding: 18px;
	    }
    
    .card-header {
	    display: flex;
	    align-items: center;
	    justify-content: space-between;
	    margin-bottom: 14px;
	    gap: 8px;
	    }
    
    .card-title {
	    font-size: 15px;
	    font-weight: 600;
	    display: flex;
	    align-items: center;
	    gap: 8px;
	    }
    
    .card-title-icon {
	    width: 22px;
	    height: 22px;
	    border-radius: 999px;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    background: var(--accent-soft-bg);
	    font-size: 13px;
	    }
    
    .card-subtitle {
	    font-size: 12px;
	    color: var(--text-soft2);
	    }
    
    /* FORM */
    
    form#configForm {
	    display: grid;
	    grid-template-columns: repeat(2, minmax(0, 1fr));
	    gap: 14px 14px;
	    }
    
    .form-group {
	    display: flex;
	    flex-direction: column;
	    gap: 4px;
	    }
    
    .form-group.full {
	    grid-column: 1 / 3;
	    }
    
    label {
	    font-size: 12px;
	    color: var(--text-soft);
	    display: flex;
	    align-items: center;
	    justify-content: space-between;
	    }
    
    label span.hint {
	    font-size: 11px;
	    color: var(--text-soft2);
	    }
    
    input[type="text"],
    input[type="datetime-local"],
    input[type="number"],
    select {
	    background: rgba(15,23,42,0.9);
	    border-radius: var(--radius-md);
	    border: 1px solid rgba(55,65,81,0.9);
	    color: var(--text-main);
	    padding: 7px 9px;
	    font-size: 13px;
	    outline: none;
	    transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
	    }
    
    input[type="text"]:focus,
    input[type="datetime-local"]:focus,
    input[type="number"]:focus,
    select:focus {
	    border-color: var(--accent);
	    box-shadow: 0 0 0 1px rgba(129,140,248,0.45);
	    background: rgba(15,23,42,1);
	    }
    
    input[type="color"] {
	    width: 100%;
	    height: 32px;
	    border-radius: var(--radius-md);
	    padding: 0;
	    border: 1px solid rgba(55,65,81,0.9);
	    background: transparent;
	    cursor: pointer;
	    }
    
    .inline-checkbox {
	    display: flex;
	    align-items: center;
	    gap: 6px;
	    font-size: 12px;
	    color: var(--text-soft);
	    }
    
    .inline-row {
	    display: flex;
	    gap: 8px;
	    align-items: center;
	    flex-wrap: wrap;
	    }
    
    input[type="checkbox"] {
	    accent-color: var(--accent);
	    cursor: pointer;
	    }
    
    input[type="range"] {
	    width: 100%;
	    }
    
    .range-row {
	    display: flex;
	    align-items: center;
	    gap: 8px;
	    }
    
    .range-value {
	    font-size: 12px;
	    color: var(--text-soft);
	    min-width: 40px;
	    text-align: right;
	    }
    
    /* BUTTON */
    
    .btn-primary {
	    grid-column: 1 / 3;
	    margin-top: 6px;
	    border: none;
	    border-radius: 999px;
	    background: linear-gradient(135deg, #4f46e5, #7c3aed);
	    color: white;
	    font-size: 14px;
	    font-weight: 500;
	    padding: 10px 16px;
	    cursor: pointer;
	    display: inline-flex;
	    align-items: center;
	    justify-content: center;
	    gap: 8px;
	    box-shadow: 0 18px 40px rgba(79,70,229,0.4);
	    }
    
    .btn-primary:hover {
	    filter: brightness(1.05);
	    }
    
    .template-badges {
	    display: flex;
	    flex-wrap: wrap;
	    gap: 6px;
	    margin-top: 6px;
	    }
    
    .badge-template {
	    font-size: 11px;
	    padding: 4px 8px;
	    border-radius: 999px;
	    border: 1px solid rgba(148,163,184,0.5);
	    color: var(--text-soft);
	    background: rgba(15,23,42,0.9);
	    }
    
    /* PREVIEW */
    
    .preview-wrapper {
	    display: flex;
	    flex-direction: column;
	    gap: 14px;
	    position: sticky;
	    top: 12px;
	    align-self: flex-start;
	    }
    
    #miniPreview {
	    width: 100%;
	    height: 80px;
	    border-radius: 999px;
	    border: 1px solid rgba(148,163,184,0.35);
	    background: radial-gradient(circle at top left,#020617 0,#020617 40%,#020617 100%);
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-weight: 600;
	    font-size: 14px;
	    padding: 8px 12px;
	    text-align: center;
	    box-shadow: 0 12px 25px rgba(15,23,42,0.75);
	    }
    
    #htmlPreview {
	    width: 100%;
	    max-width: 100%;
	    height: 220px;
	    border-radius: var(--radius-lg);
	    border: 1px solid rgba(148,163,184,0.35);
	    background: radial-gradient(circle at top left, #020617 0, #020617 40%, #020617 100%);
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-weight: 600;
	    font-size: 18px;
	    padding: 10px;
	    text-align: center;
	    box-shadow: 0 18px 45px rgba(15,23,42,0.75);
	    }
    
    .link-input {
	    width: 100%;
	    padding: 7px 10px;
	    border-radius: var(--radius-md);
	    border: 1px solid rgba(55,65,81,0.9);
	    background: rgba(15,23,42,0.9);
	    color: var(--text-main);
	    font-size: 13px;
	    }
    
    .code-block {
	    border-radius: var(--radius-md);
	    background: rgba(15,23,42,0.9);
	    border: 1px solid rgba(55,65,81,0.9);
	    padding: 10px;
	    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
	    font-size: 12px;
	    color: var(--text-soft);
	    overflow-x: auto;
	    }
    
    .helper-text {
	    font-size: 11px;
	    color: var(--text-soft2);
	    margin-top: 4px;
	    }
    
    .badge-small {
	    display: inline-flex;
	    align-items: center;
	    gap: 4px;
	    font-size: 11px;
	    background: rgba(15,23,42,0.9);
	    border-radius: 999px;
	    padding: 3px 8px;
	    border: 1px solid rgba(148,163,184,0.4);
	    color: var(--text-soft);
	    }

  </style>
</head>
<body>

<div class="page-wrapper">
  <!-- HEADER -->
  <header class="header">
    <div class="header-left">
      <div class="title-row">
        <span>üïí Countdown Studio</span>
        <span class="pill">Multi-templates ‚Ä¢ Email ready</span>
      </div>
      <div class="subtitle">
        Configure ton compte √† rebours, visualise le rendu en live, puis r√©cup√®re un lien GIF dynamique pr√™t √† int√©grer dans tes emails.
      </div>
    </div>
    <div class="header-actions">
      <a href="/admin" class="btn-ghost"><span class="icon">üîê</span>Admin</a>
      <a href="/list" class="btn-ghost"><span class="icon">üìã</span>Liste</a>
    </div>
  </header>
	
	<!-- LAYOUT 2 COLONNES -->
  <div class="layout">

    <!-- COLONNE GAUCHE : FORMULAIRE -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <div class="card-title-icon">üéõ</div>
            Configurer un nouveau countdown
          </div>
          <div class="card-subtitle">
            Tous les param√®tres sont enregistr√©s dans un ID unique. Chaque cr√©ation g√©n√®re un GIF ind√©pendant.
          </div>
        </div>
      </div>

      <form method="POST" id="configForm">

        <!-- G√âN√âRAL -->
        <div class="form-group full">
          <label>Date cible <span class="hint">Obligatoire</span></label>
          <input type="datetime-local" name="target_date" id="target_date" value="{{ target_date }}" required>
        </div>

        <div class="form-group">
          <label>Template <span class="hint">Style global</span></label>
          <select name="template" id="template">
            <option value="classic"  {% if config.template == 'classic'  %}selected{% endif %}>Classic</option>
	          <option value="blocks"   {% if config.template == 'blocks'   %}selected{% endif %}>Blocks</option>
	          <option value="flip"     {% if config.template == 'flip'     %}selected{% endif %}>Flip clock</option>
	          <option value="bubble"   {% if config.template == 'bubble'   %}selected{% endif %}>Bubble</option>
	          <option value="minimal"  {% if config.template == 'minimal'  %}selected{% endif %}>Minimal</option>
	          <option value="banner"   {% if config.template == 'banner'   %}selected{% endif %}>Banner</option>
	          <option value="progress" {% if config.template == 'progress' %}selected{% endif %}>Progress bar</option>
          </select>
        </div>

        <div class="form-group">
          <label>Alignement</label>
          <select name="alignment" id="alignment">
            <option value="left"   {% if config.alignment == 'left'   %}selected{% endif %}>Gauche</option>
	          <option value="center" {% if config.alignment == 'center' %}selected{% endif %}>Centr√©</option>
	          <option value="right"  {% if config.alignment == 'right'  %}selected{% endif %}>Droite</option>
          </select>
        </div>

        <div class="form-group">
          <label>Couleur de fond</label>
          <input type="color" name="background_color" id="background_color" value="{{ config.background_color }}">
        </div>

        <div class="form-group">
          <label>Couleur du texte</label>
          <input type="color" name="text_color" id="text_color" value="{{ config.text_color }}">
        </div>

        <div class="form-group">
          <label>Taille du texte</label>
          <div class="range-row">
            <input type="range" min="10" max="120" name="font_size" id="font_size" value="{{ config.font_size }}">
            <div class="range-value"><span id="fontSizeValue">{{ config.font_size }}</span> px</div>
          </div>
        </div>

        <div class="form-group full">
          <label>Pr√©fixe du message <span class="hint">Ex : ‚ÄúTemps restant : ‚Äù</span></label>
          <input type="text" name="message_prefix" id="message_prefix" value="{{ config.message_prefix }}">
        </div>
	      
	      <!-- IC√îNE -->
        <div class="form-group">
          <label>Ic√¥ne</label>
          <input type="text" name="icon" id="icon" value="{{ config.icon }}" placeholder="ex : ‚è≥, üî•, üéâ">
        </div>

        <div class="form-group">
          <label>Position de l‚Äôic√¥ne</label>
          <select name="icon_position" id="icon_position">
            <option value="left"   {% if config.icon_position == 'left'   %}selected{% endif %}>Avant le texte</option>
	          <option value="right"  {% if config.icon_position == 'right'  %}selected{% endif %}>Apr√®s le texte</option>
	          <option value="above"  {% if config.icon_position == 'above'  %}selected{% endif %}>Au-dessus</option>
          </select>
        </div>

        <div class="form-group">
          <label>Padding (px)</label>
          <input type="number" name="padding" id="padding" value="{{ config.padding }}" min="0" max="100">
        </div>
	      
	      <!-- BLOCS -->
        <div class="form-group full">
          <label>Blocs (Blocks / Flip / Bubble)</label>
          <div class="template-badges">
            <span class="badge-template">Fond, contour, arrondis, espacements‚Ä¶</span>
          </div>
        </div>

        <div class="form-group">
          <label>Fond blocs</label>
          <input type="color" name="block_bg_color" id="block_bg_color" value="{{ config.block_bg_color }}">
        </div>

        <div class="form-group">
          <label>Contour blocs</label>
          <input type="color" name="block_border_color" id="block_border_color" value="{{ config.block_border_color }}">
        </div>

        <div class="form-group">
          <label>√âpaisseur contour</label>
          <input type="number" name="block_border_width" id="block_border_width" value="{{ config.block_border_width }}" min="0" max="10">
        </div>

        <div class="form-group">
          <label>Rayon coins</label>
          <input type="number" name="block_radius" id="block_radius" value="{{ config.block_radius }}" min="0" max="60">
        </div>

        <div class="form-group">
          <label>Padding X blocs</label>
          <input type="number" name="block_padding_x" id="block_padding_x" value="{{ config.block_padding_x }}" min="0" max="80">
        </div>

        <div class="form-group">
          <label>Padding Y blocs</label>
          <input type="number" name="block_padding_y" id="block_padding_y" value="{{ config.block_padding_y }}" min="0" max="80">
        </div>

        <div class="form-group">
          <label>Espacement blocs</label>
          <input type="number" name="blocks_gap" id="blocks_gap" value="{{ config.blocks_gap }}" min="0" max="80">
        </div>
	      
	      <!-- LABELS -->
        <div class="form-group full">
          <div class="inline-row">
            <label>Labels J/H/M/S</label>
            <div class="inline-checkbox">
              <input type="checkbox" name="show_labels" id="show_labels" {% if config.show_labels %}checked{% endif %}>
              <span>Afficher</span>
            </div>
            <div class="inline-checkbox">
              <input type="checkbox" name="labels_custom" id="labels_custom" {% if config.labels_custom %}checked{% endif %}>
              <span>Personnalis√©s</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Couleur labels</label>
          <input type="color" name="label_color" id="label_color" value="{{ config.label_color }}">
        </div>

        <div class="form-group">
          <label>Taille labels (facteur)</label>
          <input type="number" step="0.1" min="0.2" max="1.0" name="label_size_factor" id="label_size_factor" value="{{ config.label_size_factor }}">
        </div>

        <div class="form-group">
          <label>Texte ‚Äújours‚Äù</label>
          <input type="text" name="label_days" id="label_days" value="{{ config.labels_personalized.days }}">
        </div>

        <div class="form-group">
          <label>Texte ‚Äúheures‚Äù</label>
          <input type="text" name="label_hours" id="label_hours" value="{{ config.labels_personalized.hours }}">
        </div>

        <div class="form-group">
          <label>Texte ‚Äúminutes‚Äù</label>
          <input type="text" name="label_minutes" id="label_minutes" value="{{ config.labels_personalized.minutes }}">
        </div>

        <div class="form-group">
          <label>Texte ‚Äúsecondes‚Äù</label>
          <input type="text" name="label_seconds" id="label_seconds" value="{{ config.labels_personalized.seconds }}">
        </div>
	      
	      <!-- BANNI√àRE -->
        <div class="form-group full">
          <label>Banni√®re (template Banner)</label>
        </div>

        <div class="form-group">
          <label>Fond banni√®re</label>
          <input type="color" name="banner_bg_color" id="banner_bg_color" value="{{ config.banner_bg_color }}">
        </div>

        <div class="form-group">
          <label>Texte banni√®re</label>
          <input type="color" name="banner_text_color" id="banner_text_color" value="{{ config.banner_text_color }}">
        </div>
	      
	      <!-- PROGRESS BAR -->
        <div class="form-group full">
          <label>Barre de progression (template Progress)</label>
        </div>

        <div class="form-group">
          <label>Fond barre</label>
          <input type="color" name="progress_bg_color" id="progress_bg_color" value="{{ config.progress_bg_color }}">
        </div>

        <div class="form-group">
          <label>Remplissage barre</label>
          <input type="color" name="progress_fg_color" id="progress_fg_color" value="{{ config.progress_fg_color }}">
        </div>

        <div class="form-group">
          <label>Hauteur (px)</label>
          <input type="number" name="progress_height" id="progress_height" value="{{ config.progress_height }}" min="4" max="60">
        </div>

        <div class="form-group">
          <label>Fen√™tre max (jours)</label>
          <input type="number" name="progress_max_days" id="progress_max_days" value="{{ config.progress_max_days }}" min="1" max="365">
        </div>
	      
	      <!-- SUBMIT -->
        <button type="submit" class="btn-primary">
          <span>‚ú® G√©n√©rer un nouveau countdown</span>
        </button>
      </form>
    </div>
	  
	  <!-- COLONNE DROITE : MINI + GRAND APER√áU + LIEN -->
    <div class="preview-wrapper">

      <!-- MINI PREVIEW STICKY -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-title-icon">üîç</div>
              Mini aper√ßu
            </div>
            <div class="card-subtitle">
              Aper√ßu compact toujours visible pendant que tu modifies les options.
            </div>
          </div>
          <span class="badge-small">Live</span>
        </div>
        <div id="miniPreview">Choisis un template et une date pour voir l‚Äôaper√ßu.</div>
      </div>
	    
	    <!-- GRAND PREVIEW -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-title-icon">üëÅÔ∏è</div>
              Aper√ßu d√©taill√©
            </div>
            <div class="card-subtitle">
              Simulation HTML du rendu final. Le GIF g√©n√©r√© utilisera ce style.
            </div>
          </div>
          <span class="badge-small">Auto-update ‚Ä¢ 1s</span>
        </div>
        <div id="htmlPreview">Choisis une date pour voir l‚Äôaper√ßu.</div>
      </div>
	    
	    <!-- LIEN GIF -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-title-icon">üîó</div>
              Lien GIF dynamique
            </div>
            <div class="card-subtitle">
              Utilise ce lien dans tes emails. Chaque ID est permanent et ind√©pendant.
            </div>
          </div>
        </div>

        {% if img_link %}
          <div class="form-group">
            <label>URL du GIF</label>
            <input class="link-input" readonly value="{{ img_link }}" onclick="this.select();">
            <div class="helper-text">Clique pour s√©lectionner, puis copie/colle dans ton outil d‚Äôemailing.</div>
          </div>

          <div class="form-group">
            <label>Code HTML √† int√©grer</label>
            <div class="code-block">
              &lt;img src="{{ img_link }}" alt="Countdown"&gt;
            </div>
          </div>
        {% else %}
          <div class="helper-text">
            Configure ton countdown puis clique sur <strong>‚ÄúG√©n√©rer un nouveau countdown‚Äù</strong> pour obtenir l‚ÄôURL.
          </div>
        {% endif %}
      </div>

    </div>

  </div>
</div>

<script>
  const htmlPreview = document.getElementById("htmlPreview");
  const miniPreview = document.getElementById("miniPreview");
  const fontSizeInput = document.getElementById("font_size");
  const fontSizeValue = document.getElementById("fontSizeValue");
  
  function renderTemplate(template, bg, txt, size, prefix, dateInput) {
	  // Pas de date => message neutre
	  if (!dateInput) {
		  return {
			  largeHTML: "Choisis une date pour voir l‚Äôaper√ßu.",
			  miniHTML: "Choisis une date pour voir l‚Äôaper√ßu."
		  };
	  }
	  
	  const target = new Date(dateInput);
	  const now = new Date();
	  const diff = target - now;
	  
	  if (isNaN(diff)) {
		  return {
			  largeHTML: "Date invalide",
			  miniHTML: "Date invalide"
		  };
	  }
	  
	  if (diff <= 0) {
		  return {
			  largeHTML: "‚è∞ Termin√© !",
			  miniHTML: "‚è∞ Termin√© !"
		  };
	  }
	  
	  const totalSeconds = Math.floor(diff / 1000);
	  const days = Math.floor(totalSeconds / 86400);
	  const hours = Math.floor((totalSeconds % 86400) / 3600);
	  const minutes = Math.floor((totalSeconds % 3600) / 60);
	  const seconds = totalSeconds % 60;
	  
	  // Infos pour labels / blocs
	  const labelDays = document.getElementById("label_days").value || "J";
	  const labelHours = document.getElementById("label_hours").value || "H";
	  const labelMinutes = document.getElementById("label_minutes").value || "M";
	  const labelSeconds = document.getElementById("label_seconds").value || "S";
	  const showLabels = document.getElementById("show_labels").checked;
	  const blockBg = document.getElementById("block_bg_color").value;
	  const blockBorder = document.getElementById("block_border_color").value;
	  const labelFactor = parseFloat(document.getElementById("label_size_factor").value || "0.5");
	  const labelFontSize = size * Math.max(0.3, Math.min(1, labelFactor));
	  
	  // 1) CLASSIC ‚Äì texte simple, √©l√©gant
	  if (template === "classic") {
		  const icon = document.getElementById("icon").value || "";
		  const textBase =
				  `${prefix}${days}j ${String(hours).padStart(2,"0")}:` +
				  `${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
		  const textLarge = icon ? `${icon} ${textBase}` : textBase;
		  const textMini = textBase;
		  
		  const largeHTML = `
        <div style="font-size:${size}px; display:flex; align-items:center; justify-content:center; gap:8px;">
          ${icon ? `<span>${icon}</span>` : ""}
          <span>${textBase}</span>
        </div>
      `;
		  const miniHTML = `<span style="font-size:${size * 0.6}px;">${textMini}</span>`;
		  
		  return { largeHTML, miniHTML };
	  }
	  
	  // 2) BLOCKS ‚Äì style Notion, cartes
	  if (template === "blocks") {
		  const largeHTML = `
        <div style="display:flex;gap:10px;align-items:flex-end;justify-content:center;">
          ${[["days", days, labelDays],["hours",hours,labelHours],["minutes",minutes,labelMinutes],["seconds",seconds,labelSeconds]]
				  .map(([key,val,label]) => `
              <div style="
                padding:10px 14px;
                border-radius:12px;
                background:${blockBg};
                border:1px solid ${blockBorder};
                min-width:60px;
                text-align:center;
                box-shadow:0 10px 25px rgba(15,23,42,0.55);
              ">
                <div style="font-size:${size}px;line-height:1.1;">${String(val).padStart(2,"0")}</div>
                ${showLabels ? `<div style="margin-top:4px;font-size:${labelFontSize}px;color:#9ca3af;">${label}</div>` : ""}
              </div>
            `).join("")}
        </div>
      `;
		  const miniHTML = `
        <div style="display:flex;gap:6px;justify-content:center;font-size:${size * 0.5}px;">
          <span>${String(days).padStart(2,"0")}${showLabels ? " " + labelDays : ""}</span>
          <span>${String(hours).padStart(2,"0")}${showLabels ? " " + labelHours : ""}</span>
          <span>${String(minutes).padStart(2,"0")}${showLabels ? " " + labelMinutes : ""}</span>
          <span>${String(seconds).padStart(2,"0")}${showLabels ? " " + labelSeconds : ""}</span>
        </div>
      `;
		  return { largeHTML, miniHTML };
	  }
	  
	  // 3) FLIP ‚Äì panneaux sup/inf + ligne centrale
	  if (template === "flip") {
		  const flipDigit = (value, label) => `
        <div style="display:flex;flex-direction:column;align-items:center;gap:6px;">
          <div style="
            position:relative;
            width:70px;
            height:60px;
            border-radius:8px;
            background:#111827;
            color:${txt};
            box-shadow:0 12px 25px rgba(0,0,0,0.7);
            overflow:hidden;
          ">
            <div style="
              position:absolute;top:0;left:0;right:0;
              height:50%;display:flex;align-items:center;justify-content:center;
              border-bottom:1px solid rgba(55,65,81,0.9);
              background:#111827;
            ">
              <span style="font-size:${size * 0.9}px;">${String(value).padStart(2,"0")}</span>
            </div>
            <div style="
              position:absolute;bottom:0;left:0;right:0;
              height:50%;display:flex;align-items:center;justify-content:center;
              background:#020617;
            ">
              <span style="font-size:${size * 0.9}px;">${String(value).padStart(2,"0")}</span>
            </div>
          </div>
          ${showLabels ? `<div style="font-size:${labelFontSize}px;color:#9ca3af;">${label}</div>` : ""}
        </div>
      `;
		  
		  const largeHTML = `
        <div style="display:flex;gap:10px;align-items:flex-end;justify-content:center;">
          ${flipDigit(days, labelDays)}
          ${flipDigit(hours, labelHours)}
          ${flipDigit(minutes, labelMinutes)}
          ${flipDigit(seconds, labelSeconds)}
        </div>
      `;
		  
		  const miniHTML = `
        <div style="display:flex;gap:4px;justify-content:center;font-size:${size * 0.5}px;">
          <span>${String(days).padStart(2,"0")}j</span>
          <span>${String(hours).padStart(2,"0")}h</span>
          <span>${String(minutes).padStart(2,"0")}m</span>
          <span>${String(seconds).padStart(2,"0")}s</span>
        </div>
      `;
		  return { largeHTML, miniHTML };
	  }
	  
	  // 4) BUBBLE ‚Äì bulles glossy / verre
	  if (template === "bubble") {
		  const bubble = (value, label) => `
        <div style="
          padding:10px 16px;
          border-radius:999px;
          background:linear-gradient(135deg, rgba(255,255,255,0.12), rgba(148,163,184,0.12));
          border:1px solid rgba(148,163,184,0.45);
          box-shadow:0 12px 30px rgba(15,23,42,0.8);
          backdrop-filter:blur(12px);
          -webkit-backdrop-filter:blur(12px);
          text-align:center;
          min-width:64px;
        ">
          <div style="font-size:${size}px;line-height:1.1;">${String(value).padStart(2,"0")}</div>
          ${showLabels ? `<div style="margin-top:3px;font-size:${labelFontSize}px;color:#e5e7eb;">${label}</div>` : ""}
        </div>
      `;
		  
		  const largeHTML = `
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;">
          ${bubble(days, labelDays)}
          ${bubble(hours, labelHours)}
          ${bubble(minutes, labelMinutes)}
          ${bubble(seconds, labelSeconds)}
        </div>
      `;
		  const miniHTML = `
        <div style="display:flex;gap:6px;justify-content:center;font-size:${size * 0.5}px;">
          <span style="padding:3px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.6);">
            ${String(days).padStart(2,"0")}
          </span>
          <span style="padding:3px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.4);">
            ${String(hours).padStart(2,"0")}
          </span>
          <span style="padding:3px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.4);">
            ${String(minutes).padStart(2,"0")}
          </span>
          <span style="padding:3px 8px;border-radius:999px;border:1px solid rgba(148,163,184,0.4);">
            ${String(seconds).padStart(2,"0")}
          </span>
        </div>
      `;
		  return { largeHTML, miniHTML };
	  }
	  
	  // 5) MINIMAL
	  if (template === "minimal") {
		  const largeText =
				  `${String(days).padStart(2,"0")}:` +
				  `${String(hours).padStart(2,"0")}:` +
				  `${String(minutes).padStart(2,"0")}:` +
				  `${String(seconds).padStart(2,"0")}`;
		  return {
			  largeHTML: `<span style="font-size:${size}px;">${largeText}</span>`,
			  miniHTML: `<span style="font-size:${size * 0.6}px;">${largeText}</span>`
		  };
	  }
	  
	  // 6) BANNER
	  if (template === "banner") {
		  const bannerBg = document.getElementById("banner_bg_color").value;
		  const bannerTxt = document.getElementById("banner_text_color").value;
		  const text =
				  `${prefix}${days} jours ${String(hours).padStart(2,"0")}h ` +
				  `${String(minutes).padStart(2,"0")}m ${String(seconds).padStart(2,"0")}s`;
		  
		  const largeHTML = `
        <div style="
          width:100%;
          padding:12px 18px;
          border-radius:999px;
          background:${bannerBg};
          color:${bannerTxt};
          font-size:${size * 0.6}px;
          display:flex;
          align-items:center;
          justify-content:center;
          gap:8px;
        ">
          <span>üîî</span><span>${text}</span>
        </div>
      `;
		  const miniHTML = `
        <div style="font-size:${size * 0.5}px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
          ${text}
        </div>
      `;
		  return { largeHTML, miniHTML };
	  }
	  
	  // 7) PROGRESS
	  if (template === "progress") {
		  const maxDays = parseInt(document.getElementById("progress_max_days").value || "30", 10);
		  const total = maxDays * 86400;
		  let ratio = 1 - (totalSeconds / total);
		  ratio = Math.max(0, Math.min(1, ratio));
		  const barBg = document.getElementById("progress_bg_color").value;
		  const barFg = document.getElementById("progress_fg_color").value;
		  
		  const baseText =
				  `${prefix}${days}j ${String(hours).padStart(2,"0")}:` +
				  `${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
		  
		  const largeHTML = `
        <div style="width:100%;max-width:600px;">
          <div style="width:100%;height:16px;border-radius:999px;background:${barBg};overflow:hidden;">
            <div style="width:${(ratio*100).toFixed(1)}%;height:100%;background:${barFg};"></div>
          </div>
          <div style="margin-top:10px;font-size:${size * 0.6}px;">
            ${baseText}
          </div>
        </div>
      `;
		  const miniHTML = `
        <div style="width:100%;">
          <div style="width:100%;height:8px;border-radius:999px;background:${barBg};overflow:hidden;">
            <div style="width:${(ratio*100).toFixed(1)}%;height:100%;background:${barFg};"></div>
          </div>
        </div>
      `;
		  return { largeHTML, miniHTML };
	  }
	  
	  // fallback
	  const fallback = `${prefix}${days}j ${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
	  return {
		  largeHTML: `<span style="font-size:${size}px;">${fallback}</span>`,
		  miniHTML: `<span style="font-size:${size * 0.5}px;">${fallback}</span>`
	  };
  }
  
  function updatePreview() {
	  const template = document.getElementById("template").value;
	  const bg = document.getElementById("background_color").value;
	  const txt = document.getElementById("text_color").value;
	  const size = parseInt(fontSizeInput.value || "40", 10);
	  const prefix = document.getElementById("message_prefix").value || "Temps restant : ";
	  const dateInput = document.getElementById("target_date").value;
	  
	  fontSizeValue.textContent = size;
	  
	  // appliquer couleur de fond globale sur preview large
	  htmlPreview.style.background = bg;
	  htmlPreview.style.color = txt;
	  miniPreview.style.background = "radial-gradient(circle at top left,#020617 0,#020617 40%,#020617 100%)";
	  miniPreview.style.color = txt;
	  
	  const { largeHTML, miniHTML } = renderTemplate(template, bg, txt, size, prefix, dateInput);
	  
	  htmlPreview.innerHTML = largeHTML;
	  miniPreview.innerHTML = miniHTML;
  }
  
  setInterval(updatePreview, 1000);
  document.getElementById("configForm").addEventListener("input", updatePreview);
  updatePreview();
</script>

</body>
</html>